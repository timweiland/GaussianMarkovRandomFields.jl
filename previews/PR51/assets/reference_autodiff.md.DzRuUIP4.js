import{_ as e,c as a,o as t,aA as s}from"./chunks/framework.C_CPL4_m.js";const u=JSON.parse('{"title":"Automatic Differentiation Reference","description":"","frontmatter":{},"headers":[],"relativePath":"reference/autodiff.md","filePath":"reference/autodiff.md","lastUpdated":null}'),n={name:"reference/autodiff.md"};function r(o,i,l,p,h,d){return t(),a("div",null,[...i[0]||(i[0]=[s(`<h1 id="Automatic-Differentiation-Reference" tabindex="-1">Automatic Differentiation Reference <a class="header-anchor" href="#Automatic-Differentiation-Reference" aria-label="Permalink to &quot;Automatic Differentiation Reference {#Automatic-Differentiation-Reference}&quot;">​</a></h1><p>GaussianMarkovRandomFields.jl provides automatic differentiation support for gradient-based inference and optimization. This page documents the capabilities and limitations.</p><h2 id="Supported-AD-Backends" tabindex="-1">Supported AD Backends <a class="header-anchor" href="#Supported-AD-Backends" aria-label="Permalink to &quot;Supported AD Backends {#Supported-AD-Backends}&quot;">​</a></h2><p>We support the following AD backends:</p><ul><li><p><strong>Zygote.jl</strong>: General-purpose, good first choice, works in most cases</p></li><li><p><strong>Enzyme.jl</strong>: Often 2-5× faster than Zygote, but requires attention to type stability</p></li><li><p><strong>ForwardDiff.jl</strong>: Fast in the right situations (i.e. for functions with few inputs), but support is limited. See below.</p></li></ul><p>All backends produce mathematically identical gradients.</p><h2 id="Supported-Operations" tabindex="-1">Supported Operations <a class="header-anchor" href="#Supported-Operations" aria-label="Permalink to &quot;Supported Operations {#Supported-Operations}&quot;">​</a></h2><p>The package provides custom AD rules for the following operations:</p><ol><li><p><strong>GMRF construction</strong>: <code>GMRF(μ, Q, algorithm)</code> - gradients flow through mean μ and precision matrix Q</p></li><li><p><strong>Log-probability density</strong>: <code>logpdf(gmrf, z)</code> - uses selected inversion for efficient gradient computation</p></li><li><p><strong>Gaussian approximation</strong>: <code>gaussian_approximation(prior_gmrf, obs_lik)</code> - uses Implicit Function Theorem to avoid differentiating through the optimization loop. <strong>NOTE: We do not have a custom rule for ForwardDiff for this yet. Help is appreciated!</strong></p></li></ol><p>These three operations cover most common GMRF workflows. If you need AD support for other operations, please open an issue on GitHub.</p><h2 id="Linear-Solver-Type-Stability" tabindex="-1">Linear Solver Type Stability <a class="header-anchor" href="#Linear-Solver-Type-Stability" aria-label="Permalink to &quot;Linear Solver Type Stability {#Linear-Solver-Type-Stability}&quot;">​</a></h2><p>When using Enzyme, type stability is critical. The default two-argument GMRF constructor uses a runtime dispatch to select an appropriate linear solver based on the precision matrix type. This is not type-stable and can cause issues with Enzyme.</p><p>To avoid these problems, always explicitly specify a linear solver when using Enzyme:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For general sparse matrices</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gmrf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GMRF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(μ, Q, LinearSolve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CHOLMODFactorization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For SymTridiagonal matrices (AR1, RW1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gmrf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GMRF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(μ, Q, LinearSolve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LDLtFactorization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For diagonal matrices (IID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gmrf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GMRF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(μ, Q, LinearSolve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DiagonalFactorization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><p>See the <a href="./../tutorials/automatic_differentiation">Automatic Differentiation Tutorial</a> for a complete example.</p><h2 id="Current-Limitations" tabindex="-1">Current Limitations <a class="header-anchor" href="#Current-Limitations" aria-label="Permalink to &quot;Current Limitations {#Current-Limitations}&quot;">​</a></h2><ul><li><strong>ForwardDiff</strong>: Currently only has custom rules for the constructor and <code>logpdf</code>. AD through a Gaussian approximation is going to fail.</li></ul><p>If you encounter AD issues or need support for additional operations, please open an issue on GitHub.</p><h2 id="See-Also" tabindex="-1">See Also <a class="header-anchor" href="#See-Also" aria-label="Permalink to &quot;See Also {#See-Also}&quot;">​</a></h2><ul><li><p><a href="/GaussianMarkovRandomFields.jl/previews/PR51/tutorials/automatic_differentiation#Automatic-Differentiation-for-GMRF-Hyperparameters">Automatic Differentiation for GMRF Hyperparameters</a>: Practical examples and workflows</p></li><li><p><a href="https://juliadiff.org/ChainRulesCore.jl/stable/" target="_blank" rel="noreferrer">ChainRulesCore.jl docs</a></p></li><li><p><a href="https://enzyme.mit.edu/julia/stable/" target="_blank" rel="noreferrer">Enzyme.jl docs</a></p></li></ul>`,20)])])}const f=e(n,[["render",r]]);export{u as __pageData,f as default};
